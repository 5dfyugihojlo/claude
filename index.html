<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Claude Chatbot (Puter.js)</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background:#f5f6fa; }
    #chatbox {
      max-width: 600px;
      margin: 40px auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 14px rgba(0,0,0,.1);
      display: flex;
      flex-direction: column;
      height: 80vh;
    }
    #messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .msg {
      max-width: 75%;
      padding: 10px 14px;
      border-radius: 18px;
      line-height: 1.4;
      word-wrap: break-word;
    }
    .user   { align-self: flex-end; background:#007aff; color:#fff; }
    .bot    { align-self: flex-start; background:#e5e5ea; color:#000; }
    #controls {
      border-top: 1px solid #ddd;
      display: flex;
      align-items: center;
    }
    #controls input {
      flex: 1;
      padding: 14px;
      font-size: 1rem;
      border: none;
      outline: none;
    }
    #controls button {
      padding: 0 20px;
      border: none;
      background: #007aff;
      color: #fff;
      font-size: 1.1rem;
      cursor: pointer;
      height: 50px;
    }
    #controls button:disabled { background:#ccc; cursor:not-allowed; }
    .typing { font-style: italic; opacity:.7; }
  </style>
</head>
<body>

<div id="chatbox">
  <div id="messages">
    <div class="msg bot">Hi! Ask me anything.</div>
  </div>
  <div id="controls">
    <input id="userInput" type="text" placeholder="Type a message…" autocomplete="off" />
    <button id="sendBtn">Send</button>
  </div>
</div>

<!-- Puter.js SDK -->
<script src="https://js.puter.com/v2/"></script>
<script>
  const $ = sel => document.querySelector(sel);
  const messages = $('#messages');
  const input      = $('#userInput');
  const button     = $('#sendBtn');

  // Helpers
  const addMsg = (txt, cls) => {
    const div = document.createElement('div');
    div.className = `msg ${cls}`;
    div.textContent = txt;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  };

  const thinking = () => {
    const t = document.createElement('div');
    t.id = 'typing';
    t.className = 'msg bot typing';
    t.textContent = 'Claude is typing…';
    messages.appendChild(t);
    messages.scrollTop = messages.scrollHeight;
    return t;
  };

  const send = async () => {
    const text = input.value.trim();
    if (!text) return;
    input.value = '';
    addMsg(text, 'user');

    const typing = thinking();
    button.disabled = true;

    try {
      const stream = await puter.ai.chat(text, { model: 'claude-opus-4', stream: true });
      typing.remove();
      const botDiv = document.createElement('div');
      botDiv.className = 'msg bot';
      messages.appendChild(botDiv);

      for await (const chunk of stream) {
        botDiv.textContent += chunk;
        messages.scrollTop = messages.scrollHeight;
      }
    } catch (err) {
      typing.remove();
      addMsg('Oops—something went wrong. Try again.', 'bot');
    } finally {
      button.disabled = false;
    }
  };

  // Events
  button.onclick = send;
  input.onkeydown = e => { if (e.key === 'Enter') send(); };
</script>

</body>
</html>
